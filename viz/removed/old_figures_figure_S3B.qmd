# Figure S3B {.unnumbered}

```{r}
#| eval: false
#| results: "asis"
#| echo: false
source("../_common.R")
suppressMessages(suppressPackageStartupMessages(library("Seurat")))
suppressMessages(library("magrittr"))
```

```{r}
#| eval: false
# Enrique Blanco Carmona
# e.blancocarmona@kitz-heidelberg.de
# PhD Student – Clinical Bioinformatics
# Division of Pediatric Neurooncology (B062)
# DKFZ-KiTZ | Germany

# Load samples.
sample <- readRDS("/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/datasets/microglia_paired.rds")
```

```{r}
#| eval: false
# Manually picked features from the NMF metaprograms.
features <- list("Mg Homeostatic"= c("PTPRC", "ITGAM", "P2RY12"),                          
                 "Mg Inflammatory TAMs" = c("CCL4", "IL1B", "CCL3"),                  
                 "Mg Activated"= c("CX3CR1", "GPR34", "FOXP2"),                 
                 "Mg Resident−like TAMs"= c("PLCL1", "CEBPD", "VIM"),                    
                 "BMD Anti−inflammatory TAMs"= c("CD163", "SELENOP", "MRC1"),            
                 "Mg Phagocytic"= c("GPNMB", "RGCC", "PPARG"),                 
                 "Mg IFNg TAMs"= c("IFIT2", "IFIT3", "STAT1"),                   
                 "Mg Stressed TAMs"= c("HSPA1A", "HSPA1B", "SORCS2"),                  
                 "Mg Inflammatory ICAM1+"= c("RELB", "ICAM1", "TNFAIP3"),                  
                 "BAMs" = c("LYVE1", "APOC1", "MERTK"))

p1 <- SCpubr::do_DotPlot(sample[, sample$time == "Primary"],
                         features = features,
                         group.by = "final_annotation",
                         assay = "RNA",
                         legend.title = "Primary | Avg. Expression",
                         legend.length = 20,
                         font.size = 12) + 
      ggplot2::ylab("OD") + 
      ggplot2::theme(axis.text.x.bottom = ggplot2::element_blank(),
                     axis.ticks.x.bottom = ggplot2::element_blank(),
                     axis.line.x.bottom = ggplot2::element_blank(),
                     strip.background = ggplot2::element_blank(),
                     plot.margin = ggplot2::margin(t = 0, r = 10, b = 5, l = 10))

p2 <- SCpubr::do_DotPlot(sample[, sample$time == "Relapse"],
                         features = features,
                         group.by = "final_annotation",
                         assay = "RNA",
                         sequential.palette = "YlOrRd",
                         legend.title = "Relapse | Avg. Expression",
                         legend.length = 20,
                         font.size = 12) + 
      ggplot2::ylab("AS") + 
      ggplot2::theme(strip.background = ggplot2::element_blank(),
                     strip.text = ggplot2::element_blank(),
                     plot.margin = ggplot2::margin(t = 0, r = 10, b = 0, l = 10))

p1$guides$size$title <- "Primary | Pct. Expressed"
p2$guides$size$title <- "Relapse | Pct. Expressed"

p <- patchwork::wrap_plots(A = p1,
                           B = p2,
                           C = patchwork::guide_area(),
                           design = "A
                                     B
                                     C",
                           guides = "collect") + 
     patchwork::plot_annotation(theme = ggplot2::theme(legend.position = "bottom"))

```

```{r}
#| echo: false
#| warning: false
#| message: false
#| eval: false
SCpubr::save_Plot(p,
                  figure_path = "/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/figs/Figure_S3B",
                  file_name = "Figure_S3B",
                  dpi = 300,
                  output_format = "publication",
                  width = 30,
                  height = 10)
```


<img src="../figs/Figure_S3B/Figure_S3B.png" class="mx-auto d-block" style="box-shadow: none; width: 100%"/>

