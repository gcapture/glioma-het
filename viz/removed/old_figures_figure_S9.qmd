# Figure S9 {.unnumbered}

```{r}
#| results: "asis"
#| echo: false
#| eval: false
source("../_common.R")
suppressMessages(suppressPackageStartupMessages(library("Seurat")))
suppressMessages(library("magrittr"))
```

```{r}
#| eval: false
# Enrique Blanco Carmona
# e.blancocarmona@kitz-heidelberg.de
# PhD Student â€“ Clinical Bioinformatics
# Division of Pediatric Neurooncology (B062)
# DKFZ-KiTZ | Germany

# Read in sample.
sample <- readRDS("/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/datasets/integrated_LGGs.rds")
markers <- readRDS("/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/datasets/markers_stemness_extended.rds")

# Load diffusion analysis.
diff.map <- readRDS("/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/datasets/diffusion_map_extended.rds")

# Set the diffusion analysis as a dimensional reduction of the seurat object.
sample@reductions$diffusion <- Seurat::CreateDimReducObject(embeddings = diff.map@eigenvectors,
                                                            key = "DC_",
                                                            assay = "SCT")

# Cluster colors.
cluster_cols <- c("RA" = "#ECA809",
                  "OPC-like" = "#043362",                    
                  "Astro-like" = "#9A031E",                 
                  "Cycling" = "#5F0F40")


# Exclude gradient for a better visualization.
sample <- sample[, sample$relabelling != "Gradient"]
sample$Annotation <- sample$relabelling
```

```{r}
#| eval: false
p1 <- SCpubr::do_DimPlot(sample = sample,
                         reduction = "diffusion",
                         colors.use = cluster_cols,
                         raster = TRUE,
                         raster.dpi = 2048,
                         pt.size = 4,
                         font.size = 14,
                         legend.icon.size = 8)

out <- SCpubr::do_DiffusionMapPlot(sample = sample,  
                                   input_gene_list = markers, 
                                   group.by = "Annotation", 
                                   colors.use = list("Annotation" = cluster_cols), 
                                   flavor = "Seurat",
                                   font.size = 14,
                                   interpolate = FALSE,
                                   main.heatmap.size = 0.95)
p2 <- out$DC_1 & ggplot2::ylab("")
p3 <- out$DC_2 & ggplot2::ylab("")

```


```{r}
#| echo: false
#| warning: false
#| message: false
#| eval: false
SCpubr::save_Plot(plot = p1, 
                  figure_path = "/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/figs/Figure_S9", 
                  file_name = "Figure_S9-1", 
                  output_format = "publication", 
                  dpi = 300, 
                  width = 10, 
                  height = 11)

SCpubr::save_Plot(plot = p2, 
                  figure_path = "/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/figs/Figure_S9", 
                  file_name = "Figure_S9-2", 
                  output_format = "publication", 
                  dpi = 300, 
                  width = 20, 
                  height = 7)

SCpubr::save_Plot(plot = p3, 
                  figure_path = "/omics/odcf/analysis/OE0145_projects/idh_gliomas/Figures_Science/revision/IDH_gliomas_book/figs/Figure_S9", 
                  file_name = "Figure_S9-3", 
                  output_format = "publication", 
                  dpi = 300, 
                  width = 20, 
                  height = 7)
```
```

<img src="../figs/Figure_S9/Figure_S9-1.png" class="mx-auto d-block" style="box-shadow: none; width: 100%"/>
<img src="../figs/Figure_S9/Figure_S9-2.png" class="mx-auto d-block" style="box-shadow: none; width: 100%"/>
<img src="../figs/Figure_S9/Figure_S9-3.png" class="mx-auto d-block" style="box-shadow: none; width: 100%"/>
